name: Discord commit links (preview)

on:
  push:
    branches: ["main", "dev"]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Ensure jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: Send commit links to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMITS_JSON: ${{ toJson(github.event.commits) }}
          REPO: ${{ github.repository }}
          BRANCH: ${{ github.ref_name }}
          PUSHER: ${{ github.actor }}
        run: |
          |
          curl -X POST -H "Content-Type: application/json" \
          -d "{\"content\": \"ðŸš€ **Push to Master Branch!**\nðŸ“‚ **Repo:** <https://github.com/${{ github.repository }}>\nðŸ‘¤ **Pusher:** <https://github.com/${{ github.actor }}>\nðŸ”— **Commit:** [${SHORT_SHA}](https://github.com/${{ github.repository }}/commit/${{ github.sha }})\"}" \
          $DISCORD_WEBHOOK_URL
